{% extends "auctions/layout.html" %}

{% block body %}
    <h2>Active Listings</h2>

    <div  style="border: 1px solid black;">
    {% for listing in listings %}
       <a href="{% url 'listing' id=listing.id %}" >{{listing.product}}</a> 
        <img src="{{listing.picture_url}}"/>
        {{listing.description}}
        {{listing.category}}

        <!--Renderizado de la ultima bid-->
        {% for bid in listing.bid_set.all %}
        <p>{{ bid.bid }}</p>
        {% endfor %}

        {% if listing.is_active %}
        <p>Esta activo</p>
        <form action="{% url 'close' id=listing.id %}" method="POST">
            {% csrf_token %}
            <input type="checkbox" name="is_active" value="False">
            <button type="submit">Close</button>
        </form>
    {% else %}
        {% for bid in listing.bids %}
        <li>{{ bid.user.username }} ofreció ${{ bid.bid }} y gano</li>
        {% endfor %}
    {% endif %}
     <!-- Añadir o quitar de la lista de deseos -->
     {% if listing in request.user.watchlist.all %}
     <form action="{% url 'remove_from_watchlist' id=listing.id %}" method="post">
         {% csrf_token %}
         <button type="submit">Quitar de Watchlist</button>
     </form>
 {% else %}
     <form action="{% url 'add_to_watchlist' id=listing.id %}" method="post">
         {% csrf_token %}
         <button type="submit">Añadir a Watchlist</button>
     </form>
 {% endif %}

      
    


    {% endfor %}
    </div>
{% endblock %}